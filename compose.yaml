# Network 명시적 정의
networks:
  short4_network:
    driver: bridge

# 서비스 정의
services:
  mongodb:
    image: 'mongo:latest'
    environment:
      MONGO_INITDB_DATABASE: short4
      MONGO_INITDB_ROOT_USERNAME: short4
      MONGO_INITDB_ROOT_PASSWORD: /run/secrets/mongodb_password
    expose:
      - '27017'
  redis:
    image: 'redis:latest'
    expose:
      - '6379'
  springboot-app:
    build:
      context: .
      dockerfile: Dockerfile
    depends_on:
      - redis
      - mongodb
    networks:
      - short4_network
    ports:
      - '8080:8080'

# 인증정보 정의
secrets:
  mongodb_username:
    file: ./secret/mongodb_username.secret
  mongodb_password:
    file: ./secret/mongodb_password.secret
